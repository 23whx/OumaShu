---
import Base from '../layouts/Base.astro';
import { tools, categories, getToolsCountByCategory } from '../data/tools';

// 默认显示第一个分类的工具
const defaultCategory = categories[0];
const defaultTools = tools.filter(tool => tool.category === defaultCategory.id);
---

<Base 
  title="OumaShu - 小工具导航站"
  description="极简日式风格的小工具集合站。分类浏览，提升您的工作效率。"
  keywords="工具, 效率, 导航, 应用, 生产力, 分类"
>
  <div class="min-h-screen flex">
    <!-- 移动端遮罩层 -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden" aria-hidden="true"></div>

    <!-- 左侧边栏 -->
    <aside id="sidebar" class="w-64 bg-white dark:bg-black border-r border-gray-200 dark:border-gray-700 fixed h-full overflow-y-auto flex flex-col z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
      <!-- Logo -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center space-x-3">
          <img src="/logo.png" alt="OumaShu Logo" class="w-8 h-8" />
          <div>
            <h1 class="text-xl font-bold text-gray-900 dark:text-white">OumaShu</h1>
            <p class="text-sm text-gray-600 dark:text-gray-400">小工具导航站</p>
          </div>
        </div>
      </div>

      <!-- 分类列表 -->
      <nav class="p-4">
        <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">
          工具分类
        </h2>
        <ul class="space-y-1" id="category-list">
          {categories.map((category, index) => {
            const toolCount = getToolsCountByCategory(tools, category.id);
            return (
              <li>
                <button
                  data-category={category.id}
                  class={`
                    w-full flex items-center justify-between px-3 py-2 rounded-lg text-left transition-all duration-200
                    ${index === 0 
                      ? 'bg-sakura-50 dark:bg-sakura-900/20 text-sakura-600 dark:text-sakura-400 border border-sakura-200 dark:border-sakura-800' 
                      : 'text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700'
                    }
                    category-btn
                  `}
                >
                  <div class="flex items-center space-x-3">
                    <span class="text-lg">{category.icon}</span>
                    <span class="font-medium">{category.name}</span>
                  </div>
                  <span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full">
                    {toolCount}
                  </span>
                </button>
              </li>
            );
          })}
        </ul>
      </nav>

      <!-- 控制面板 -->
      <div class="p-4 mt-auto border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-black">
        <div class="flex items-center justify-between">
          <!-- 主题切换 -->
          <div class="relative">
            <button 
              id="theme-toggle-btn"
              class="p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              title="主题切换"
            >
              <span id="theme-icon" class="text-lg">💻</span>
            </button>
          </div>
          
          <!-- 语言切换 -->
          <div class="relative">
            <button 
              id="language-toggle-btn"
              class="flex items-center space-x-1 px-2 py-1 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              title="语言切换"
            >
              <span id="language-flag">🇨🇳</span>
              <span class="text-xs">▼</span>
            </button>
            
            <!-- 语言下拉菜单 -->
            <div 
              id="language-dropdown" 
              class="hidden absolute bottom-full mb-2 right-0 w-44 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50"
            >
              <div class="py-1">
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="zh-CN">
                  <span>🇨🇳</span>
                  <span>简体中文</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="zh-TW">
                  <span>🇹🇼</span>
                  <span>繁體中文</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="en">
                  <span>🇺🇸</span>
                  <span>English</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="ja-JP">
                  <span>🇯🇵</span>
                  <span>日本語</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="ar">
                  <span>🇸🇦</span>
                  <span>العربية</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="ru">
                  <span>🇷🇺</span>
                  <span>Русский</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- 主内容区域 -->
    <main class="flex-1 lg:ml-64 bg-gray-50 dark:bg-black min-h-screen">
      <!-- 移动端顶部栏 -->
      <div class="lg:hidden bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 sticky top-0 z-20">
        <div class="flex items-center justify-between">
          <button id="mobile-menu-btn" class="p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>
          <div class="flex items-center space-x-2">
            <img src="/logo.png" alt="OumaShu Logo" class="w-6 h-6" />
            <span class="text-lg font-bold text-gray-900 dark:text-white">OumaShu</span>
          </div>
          <div class="w-10"></div> <!-- 占位符保持居中 -->
        </div>
      </div>

      <!-- 顶部标题栏 -->
      <header class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 lg:px-8 py-4 lg:py-6">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center" id="category-title">
              <span class="mr-3 text-3xl">{defaultCategory.icon}</span>
              {defaultCategory.name}
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mt-1" id="category-description">
              {defaultCategory.description}
            </p>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400" id="tools-count-text">
            <span id="tools-count">{defaultTools.length}</span> <span id="tools-count-unit">个工具</span>
          </div>
        </div>
      </header>

      <!-- 工具卡片网格 -->
      <div class="p-4 lg:p-8 bg-gray-50 dark:bg-black">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6" id="tools-grid">
          {defaultTools.map((tool) => (
            <div 
              class="group cursor-pointer tool-card"
              data-tool-url={tool.url}
              data-tool-subdomain={tool.subdomain}
            >
              <div class="relative overflow-hidden rounded-xl p-6 h-50 bg-gradient-to-br from-sakura-400 to-sakura-600 hover:from-sakura-500 hover:to-sakura-700 transform hover:scale-105 transition-all duration-300 ease-out shadow-lg hover:shadow-xl text-white" style="background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);">
                {/* 背景装饰 */}
                <div class="absolute top-0 right-0 opacity-20">
                  <div class="w-32 h-32 rounded-full bg-white transform translate-x-8 -translate-y-8"></div>
                </div>
                <div class="absolute bottom-0 left-0 opacity-10">
                  <div class="w-24 h-24 rounded-full bg-white transform -translate-x-4 translate-y-4"></div>
                </div>

                {/* 内容 */}
                <div class="relative z-10 h-full flex flex-col">
                  <div class="flex items-center justify-between mb-4">
                    <div class="text-3xl">{tool.icon || '🛠️'}</div>
                    {tool.thirdParty ? (
                      <span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full third-party-badge">
                        🔗 <span class="third-party-text">第三方</span>
                      </span>
                    ) : tool.featured && (
                      <span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full featured-badge">
                        ⭐ <span class="featured-text">推荐</span>
                      </span>
                    )}
                  </div>
                  
                  <h3 class="text-xl font-bold mb-2 line-clamp-1">
                    {tool.name}
                  </h3>
                  
                  <p class="text-white/90 text-sm line-clamp-2 mb-4 flex-1">
                    {tool.description}
                  </p>
                  
                  <div class="flex items-center justify-between">
                    <div class="flex flex-wrap gap-1">
                      {tool.tags.slice(0, 2).map((tag) => (
                        <span class="bg-white/20 backdrop-blur-sm text-xs px-2 py-1 rounded-full">
                          {tag}
                        </span>
                      ))}
                    </div>
                    
                    <div class="flex items-center text-white/80">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* 空状态 */}
        <div id="empty-state" class="hidden text-center py-16">
          <div class="text-6xl mb-4">📦</div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2" id="empty-state-title">
            该分类暂无工具
          </h3>
          <p class="text-gray-600 dark:text-gray-400" id="empty-state-desc">
            更多工具正在开发中，敬请期待！
          </p>
        </div>
      </div>
    </main>
  </div>
</Base>

<!-- 工具数据 -->
<script define:vars={{ tools, categories }}>
  // 工具数据
  window.toolsData = tools;
  window.categoriesData = categories;
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // 移动端菜单切换
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    
    function openSidebar() {
      sidebar?.classList.remove('-translate-x-full');
      sidebarOverlay?.classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // 防止背景滚动
    }
    
    function closeSidebar() {
      sidebar?.classList.add('-translate-x-full');
      sidebarOverlay?.classList.add('hidden');
      document.body.style.overflow = ''; // 恢复滚动
    }
    
    mobileMenuBtn?.addEventListener('click', openSidebar);
    sidebarOverlay?.addEventListener('click', closeSidebar);
    
    // 点击侧边栏分类按钮后在移动端自动关闭侧边栏
    const categoryButtons = document.querySelectorAll('.category-btn');
    categoryButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (window.innerWidth < 1024) { // lg断点
          closeSidebar();
        }
      });
    });
    
    // 主题切换功能
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const themeIcon = document.getElementById('theme-icon');
    
    // 获取当前主题
    function getCurrentTheme() {
      return localStorage.getItem('theme') || 'system';
    }
    
    // 获取实际主题（处理 system 模式）
    function getActualTheme(theme) {
      if (theme === 'system') {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      return theme;
    }
    
    // 应用主题
    function applyTheme(theme) {
      const actualTheme = getActualTheme(theme);
      document.documentElement.setAttribute('data-theme', actualTheme);
      
      // 更新图标
      const icons = { light: '☀️', dark: '🌙', system: '💻' };
      themeIcon.textContent = icons[theme] || '💻';
      
      // 更新 meta theme-color
      const metaThemeColor = document.querySelector('meta[name="theme-color"]');
      if (metaThemeColor) {
        metaThemeColor.setAttribute('content', actualTheme === 'dark' ? '#000000' : '#fff5f7');
      }
    }
    
    // 初始化主题
    let currentTheme = getCurrentTheme();
    applyTheme(currentTheme);
    
    // 主题切换点击事件
    themeToggleBtn.addEventListener('click', () => {
      const themes = ['light', 'dark', 'system'];
      const currentIndex = themes.indexOf(currentTheme);
      const nextIndex = (currentIndex + 1) % themes.length;
      currentTheme = themes[nextIndex];
      
      localStorage.setItem('theme', currentTheme);
      applyTheme(currentTheme);
    });
    
    // 语言切换功能
    const languageToggleBtn = document.getElementById('language-toggle-btn');
    const languageDropdown = document.getElementById('language-dropdown');
    const languageFlag = document.getElementById('language-flag');
    const languageOptions = document.querySelectorAll('.language-option');
    
    // 分类和工具相关元素
    // categoryButtons 已在上面定义
    const toolsGrid = document.getElementById('tools-grid');
    const categoryTitle = document.getElementById('category-title');
    const categoryDescription = document.getElementById('category-description');
    const toolsCount = document.getElementById('tools-count');
    const emptyState = document.getElementById('empty-state');
    
    const localeData = {
      'zh-CN': { flag: '🇨🇳', name: '简体中文' },
      'zh-TW': { flag: '🇹🇼', name: '繁體中文' },
      'en': { flag: '🇺🇸', name: 'English' },
      'ja-JP': { flag: '🇯🇵', name: '日本語' },
      'ar': { flag: '🇸🇦', name: 'العربية' },
      'ru': { flag: '🇷🇺', name: 'Русский' }
    };

    // 翻译映射
    const translations = {
      'zh-CN': {
        'site_name': 'OumaShu',
        'site_subtitle': '小工具导航站',
        'categories_title': '工具分类',
        'tools_count': '个工具',
        'featured_text': '推荐',
        'third_party_text': '第三方',
        'theme_toggle_title': '主题切换',
        'language_toggle_title': '语言切换',
        'empty_state_title': '该分类暂无工具',
        'empty_state_desc': '更多工具正在开发中，敬请期待！',
        'categories': {
          'entertainment': '娱乐',
          'education': '教育',
          'workplace-slack': '职场摸鱼',
          'search': '搜索',
          'text': '文本',
          'image': '图片',
          'video': '视频',
          'audio': '音频',
          'file-transfer': '文件传输'
        },
        'category_descriptions': {
          'entertainment': '娱乐工具和有趣应用',
          'education': '教育工具和学习资源',
          'workplace-slack': '职场娱乐和放松工具',
          'search': '搜索引擎和发现工具',
          'text': '文本处理和编辑工具',
          'image': '图片处理和编辑工具',
          'video': '视频处理和转换工具',
          'audio': '音频处理和转换工具',
          'file-transfer': '文件共享和传输工具'
        },
        'tools': {
          'learn-languages': {
            'name': '语言学习助手',
            'description': 'AI 对话练习与 PDF 问答训练，提升外语能力的完整解决方案'
          },
          'subtitle-screenshot': {
            'name': '字幕截图生成器', 
            'description': '名人背景字幕截图生成器，快速制作有趣的字幕模因图片'
          },
          'media-trim': {
            'name': '视频音频转换器',
            'description': '在线视频转音频工具，支持音频剪切、格式转换'
          },
          'mbti-test': {
            'name': 'MBTI人格测试',
            'description': '专业MBTI人格类型测试，68题深度分析，了解你的性格特征和行为模式'
          },
          'video2gif': {
            'name': 'Video2GIF 转换器',
            'description': '在线视频转GIF工具，支持多种视频格式，快速生成高质量GIF动图'
          },
          'pic-press': {
            'name': 'PicPress 图片压缩器',
            'description': '免费在线批量图片压缩工具，支持JPG、PNG、WebP、AVIF格式，本地处理保护隐私'
          },
          'pansou': {
            'name': 'PanSou 网盘搜索',
            'description': '高性能网盘资源搜索API服务，支持TG频道和插件搜索，多频道并发搜索与智能排序'
          },
          'text-grove': {
            'name': 'TextGrove 文本工具站',
            'description': '全功能文本处理工具集，包含字数统计、文本去重、词频统计、简繁转换、文本格式化，本地处理保护隐私'
          },
          'p2p-transfer': {
            'name': 'P2P 端到端传输',
            'description': '安全的端到端文件和文字传输工具，数据不经过服务器，保护隐私安全'
          },
          'work-whale': {
            'name': 'Work Whale 摸鱼阅读器',
            'description': '伪装成Microsoft Word界面的网页端小说阅读器，完美融入办公环境，让你安心摸鱼'
          },
          'stealth-novel': {
            'name': 'StealthNovel 隐蔽阅读器',
            'description': 'Windows桌面版隐蔽小说阅读器，支持任务栏标题显示和伪装弹窗模式，办公室摸鱼必备神器'
          }
        }
      },
      'zh-TW': {
        'site_name': 'OumaShu',
        'site_subtitle': '小工具導航站',
        'categories_title': '工具分類',
        'tools_count': '個工具',
        'featured_text': '推薦',
        'third_party_text': '第三方',
        'theme_toggle_title': '主題切換',
        'language_toggle_title': '語言切換',
        'empty_state_title': '該分類暫無工具',
        'empty_state_desc': '更多工具正在開發中，敬請期待！',
        'categories': {
          'entertainment': '娛樂',
          'education': '教育',
          'workplace-slack': '職場摸魚',
          'search': '搜尋',
          'text': '文本',
          'image': '圖片',
          'video': '視頻',
          'audio': '音頻',
          'file-transfer': '文件傳輸'
        },
        'category_descriptions': {
          'entertainment': '娛樂工具和有趣應用',
          'education': '教育工具和學習資源',
          'workplace-slack': '職場娛樂和放鬆工具',
          'search': '搜尋引擎和發現工具',
          'text': '文本處理和編輯工具',
          'image': '圖片處理和編輯工具',
          'video': '視頻處理和轉換工具',
          'audio': '音頻處理和轉換工具',
          'file-transfer': '文件共享和傳輸工具'
        },
        'tools': {
          'learn-languages': {
            'name': '語言學習助手',
            'description': 'AI 對話練習與 PDF 問答訓練，提升外語能力的完整解決方案'
          },
          'subtitle-screenshot': {
            'name': '字幕截圖生成器',
            'description': '名人背景字幕截圖生成器，快速製作有趣的字幕模因圖片'
          },
          'media-trim': {
            'name': '視頻音頻轉換器',
            'description': '線上視頻轉音頻工具，支援音頻剪切、格式轉換'
          },
          'mbti-test': {
            'name': 'MBTI人格測試',
            'description': '專業MBTI人格類型測試，68題深度分析，了解你的性格特徵和行為模式'
          },
          'video2gif': {
            'name': 'Video2GIF 轉換器',
            'description': '線上視頻轉GIF工具，支援多種視頻格式，快速生成高質量GIF動圖'
          },
          'pic-press': {
            'name': 'PicPress 圖片壓縮器',
            'description': '免費線上批量圖片壓縮工具，支援JPG、PNG、WebP、AVIF格式，本地處理保護隱私'
          },
          'pansou': {
            'name': 'PanSou 網盤搜尋',
            'description': '高性能網盤資源搜尋API服務，支援TG頻道和插件搜尋，多頻道並發搜尋與智能排序'
          },
          'text-grove': {
            'name': 'TextGrove 文本工具站',
            'description': '全功能文本處理工具集，包含字數統計、文本去重、詞頻統計、簡繁轉換、文本格式化，本地處理保護隱私'
          },
          'p2p-transfer': {
            'name': 'P2P 端到端傳輸',
            'description': '安全的端到端文件和文字傳輸工具，數據不經過服務器，保護隱私安全'
          },
          'work-whale': {
            'name': 'Work Whale 摸魚閱讀器',
            'description': '偽裝成Microsoft Word界面的網頁端小說閱讀器，完美融入辦公環境，讓你安心摸魚'
          },
          'stealth-novel': {
            'name': 'StealthNovel 隱蔽閱讀器',
            'description': 'Windows桌面版隱蔽小說閱讀器，支持任務欄標題顯示和偽裝彈窗模式，辦公室摸魚必備神器'
          }
        }
      },
      'en': {
        'site_name': 'OumaShu',
        'site_subtitle': 'Tools Directory',
        'categories_title': 'Tool Categories',
        'tools_count': 'tools',
        'featured_text': 'Featured',
        'third_party_text': '3rd Party',
        'theme_toggle_title': 'Toggle theme',
        'language_toggle_title': 'Switch language',
        'empty_state_title': 'No tools in this category',
        'empty_state_desc': 'More tools are coming soon!',
        'categories': {
          'entertainment': 'Entertainment',
          'education': 'Education',
          'workplace-slack': 'Workplace Slack',
          'search': 'Search',
          'text': 'Text',
          'image': 'Image',
          'video': 'Video',
          'audio': 'Audio',
          'file-transfer': 'File Transfer'
        },
        'category_descriptions': {
          'entertainment': 'Fun tools and entertainment utilities',
          'education': 'Educational tools and learning resources',
          'workplace-slack': 'Tools for workplace entertainment and relaxation',
          'search': 'Search engines and discovery tools',
          'text': 'Text processing and editing tools',
          'image': 'Image processing and editing tools',
          'video': 'Video processing and conversion tools',
          'audio': 'Audio processing and conversion tools',
          'file-transfer': 'File sharing and transfer tools'
        },
        'tools': {
          'learn-languages': {
            'name': 'Learn Languages',
            'description': 'AI conversation practice and PDF Q&A training for language learning'
          },
          'subtitle-screenshot': {
            'name': 'Subtitle Screenshot Generator',
            'description': 'Celebrity background subtitle screenshot generator for creating memes'
          },
          'media-trim': {
            'name': 'MediaTrim',
            'description': 'Online video to audio converter with audio trimming and format conversion'
          },
          'mbti-test': {
            'name': 'MBTI Personality Test',
            'description': 'Professional MBTI personality test with 68 questions for deep analysis'
          },
          'video2gif': {
            'name': 'Video2GIF Converter',
            'description': 'Online video to GIF converter supporting multiple formats for high-quality animations'
          },
          'pic-press': {
            'name': 'PicPress Image Compressor',
            'description': 'Free online batch image compressor supporting JPG, PNG, WebP, AVIF formats with local processing for privacy'
          },
          'pansou': {
            'name': 'PanSou Cloud Search',
            'description': 'High-performance cloud storage search API service with TG channel and plugin support, concurrent multi-channel search'
          },
          'text-grove': {
            'name': 'TextGrove Text Tools',
            'description': 'Comprehensive text processing toolkit with word count, deduplication, frequency analysis, traditional/simplified conversion, and formatting'
          },
          'p2p-transfer': {
            'name': 'P2P End-to-End Transfer',
            'description': 'Secure end-to-end file and text transfer tool, data never passes through servers, protecting privacy and security'
          },
          'work-whale': {
            'name': 'Work Whale Reader',
            'description': 'A web-based novel reader disguised as Microsoft Word interface, perfectly blends into office environment'
          },
          'stealth-novel': {
            'name': 'StealthNovel Stealth Reader',
            'description': 'Windows desktop stealth novel reader with taskbar title display and disguised popup modes, essential for office reading'
          }
        }
      },
      'ja-JP': {
        'site_name': 'OumaShu',
        'site_subtitle': 'ツールディレクトリ',
        'categories_title': 'ツールカテゴリ',
        'tools_count': 'ツール',
        'featured_text': 'おすすめ',
        'third_party_text': 'サードパーティ',
        'theme_toggle_title': 'テーマ切り替え',
        'language_toggle_title': '言語切り替え',
        'empty_state_title': 'このカテゴリにはツールがありません',
        'empty_state_desc': 'より多くのツールが近日公開予定です！',
        'categories': {
          'entertainment': 'エンターテイメント',
          'education': '教育',
          'workplace-slack': '職場サボり',
          'search': '検索',
          'text': 'テキスト',
          'image': '画像',
          'video': '動画',
          'audio': '音声',
          'file-transfer': 'ファイル転送'
        },
        'category_descriptions': {
          'entertainment': '楽しいツールとエンターテイメントユーティリティ',
          'education': '教育ツールと学習リソース',
          'workplace-slack': '職場でのエンターテイメントとリラクゼーションツール',
          'search': '検索エンジンと発見ツール',
          'text': 'テキスト処理と編集ツール',
          'image': '画像処理と編集ツール',
          'video': '動画処理と変換ツール',
          'audio': '音声処理と変換ツール',
          'file-transfer': 'ファイル共有と転送ツール'
        },
        'tools': {
          'learn-languages': {
            'name': '言語学習アシスタント',
            'description': 'AI会話練習とPDF Q&A学習で外国語能力を向上'
          },
          'subtitle-screenshot': {
            'name': '字幕スクリーンショット生成器',
            'description': '有名人背景字幕スクリーンショット生成器でミーム画像作成'
          },
          'media-trim': {
            'name': '動画音声変換ツール',
            'description': 'オンライン動画から音声変換、音声トリミング、フォーマット変換ツール'
          },
          'mbti-test': {
            'name': 'MBTI性格診断',
            'description': '68問の詳細分析による専門的なMBTI性格タイプテスト'
          },
          'video2gif': {
            'name': 'Video2GIF コンバーター',
            'description': 'オンライン動画からGIF変換ツール、複数フォーマット対応で高品質アニメーション生成'
          },
          'pic-press': {
            'name': 'PicPress 画像圧縮ツール',
            'description': '無料オンライン一括画像圧縮ツール、JPG・PNG・WebP・AVIF対応、ローカル処理でプライバシー保護'
          },
          'pansou': {
            'name': 'PanSou クラウド検索',
            'description': '高性能クラウドストレージ検索APIサービス、TGチャンネルとプラグイン対応、マルチチャンネル並行検索'
          },
          'text-grove': {
            'name': 'TextGrove テキストツール',
            'description': '包括的なテキスト処理ツールキット、文字数カウント、重複除去、頻度分析、繁体字・簡体字変換、フォーマット機能'
          },
          'p2p-transfer': {
            'name': 'P2P エンドツーエンド転送',
            'description': '安全なエンドツーエンドファイル・テキスト転送ツール、データはサーバーを経由せず、プライバシーとセキュリティを保護'
          },
          'work-whale': {
            'name': 'Work Whale リーダー',
            'description': 'Microsoft Wordインターフェースに偽装したウェブベースの小説リーダー、オフィス環境に完璧に溶け込む'
          },
          'stealth-novel': {
            'name': 'StealthNovel ステルスリーダー',
            'description': 'Windowsデスクトップ版ステルス小説リーダー、タスクバータイトル表示と偽装ポップアップモード対応、オフィス読書の必需品'
          }
        }
      },
      'ar': {
        'site_name': 'OumaShu',
        'site_subtitle': 'دليل الأدوات',
        'categories_title': 'فئات الأدوات',
        'tools_count': 'أدوات',
        'featured_text': 'مميز',
        'third_party_text': 'طرف ثالث',
        'theme_toggle_title': 'تبديل المظهر',
        'language_toggle_title': 'تغيير اللغة',
        'empty_state_title': 'لا توجد أدوات في هذه الفئة',
        'empty_state_desc': 'المزيد من الأدوات قادمة قريباً!',
        'categories': {
          'entertainment': 'الترفيه',
          'education': 'التعليم',
          'workplace-slack': 'التسلل في العمل',
          'search': 'البحث',
          'text': 'النص',
          'image': 'الصور',
          'video': 'الفيديو',
          'audio': 'الصوت',
          'file-transfer': 'نقل الملفات'
        },
        'category_descriptions': {
          'entertainment': 'أدوات ممتعة ومرافق ترفيهية',
          'education': 'أدوات تعليمية وموارد تعلم',
          'workplace-slack': 'أدوات الترفيه والاسترخاء في مكان العمل',
          'search': 'محركات البحث وأدوات الاكتشاف',
          'text': 'أدوات معالجة وتحرير النصوص',
          'image': 'أدوات معالجة وتحرير الصور',
          'video': 'أدوات معالجة وتحويل الفيديو',
          'audio': 'أدوات معالجة وتحويل الصوت',
          'file-transfer': 'أدوات مشاركة ونقل الملفات'
        },
        'tools': {
          'learn-languages': {
            'name': 'تعلم اللغات',
            'description': 'ممارسة المحادثة بالذكاء الاصطناعي وتدريب الأسئلة والأجوبة لتعلم اللغات'
          },
          'subtitle-screenshot': {
            'name': 'مولد لقطة الشاشة مع الترجمة',
            'description': 'مولد لقطات الشاشة مع ترجمة المشاهير لإنشاء الميمات'
          },
          'media-trim': {
            'name': 'محول الفيديو والصوت',
            'description': 'أداة تحويل الفيديو إلى صوت عبر الإنترنت مع قص الصوت وتحويل التنسيقات'
          },
          'mbti-test': {
            'name': 'اختبار شخصية MBTI',
            'description': 'اختبار MBTI مهني مع 68 سؤال للتحليل العميق لنوع الشخصية'
          },
          'video2gif': {
            'name': 'محول Video2GIF',
            'description': 'أداة تحويل الفيديو إلى GIF عبر الإنترنت مع دعم تنسيقات متعددة لإنشاء رسوم متحركة عالية الجودة'
          },
          'pic-press': {
            'name': 'ضاغط الصور PicPress',
            'description': 'أداة ضغط الصور المجانية عبر الإنترنت، تدعم JPG وPNG وWebP وAVIF، معالجة محلية لحماية الخصوصية'
          },
          'pansou': {
            'name': 'بحث التخزين السحابي PanSou',
            'description': 'خدمة بحث عالية الأداء لموارد التخزين السحابي مع دعم قنوات TG والمكونات الإضافية، بحث متزامن متعدد القنوات'
          },
          'text-grove': {
            'name': 'أدوات النص TextGrove',
            'description': 'مجموعة شاملة من أدوات معالجة النصوص مع عد الكلمات وإزالة التكرار وتحليل التردد وتحويل الصينية التقليدية/المبسطة والتنسيق'
          },
          'p2p-transfer': {
            'name': 'نقل P2P من النهاية إلى النهاية',
            'description': 'أداة آمنة لنقل الملفات والنصوص من النهاية إلى النهاية، البيانات لا تمر عبر الخوادم، حماية الخصوصية والأمان'
          },
          'work-whale': {
            'name': 'قارئ Work Whale',
            'description': 'قارئ روايات ويب متنكر في واجهة Microsoft Word، يندمج بشكل مثالي في بيئة المكتب'
          },
          'stealth-novel': {
            'name': 'قارئ StealthNovel المخفي',
            'description': 'قارئ روايات مخفي لسطح المكتب Windows مع عرض عنوان شريط المهام ووضع النوافذ المنبثقة المقنعة، ضروري للقراءة في المكتب'
          }
        }
      },
      'ru': {
        'site_name': 'OumaShu',
        'site_subtitle': 'Каталог инструментов',
        'categories_title': 'Категории инструментов',
        'tools_count': 'инструментов',
        'featured_text': 'Рекомендуемое',
        'third_party_text': 'Сторонний',
        'theme_toggle_title': 'Переключить тему',
        'language_toggle_title': 'Изменить язык',
        'empty_state_title': 'В этой категории нет инструментов',
        'empty_state_desc': 'Больше инструментов появится в ближайшее время!',
        'categories': {
          'entertainment': 'Развлечения',
          'education': 'Образование',
          'workplace-slack': 'Прокрастинация',
          'search': 'Поиск',
          'text': 'Текст',
          'image': 'Изображения',
          'video': 'Видео',
          'audio': 'Аудио',
          'file-transfer': 'Передача файлов'
        },
        'category_descriptions': {
          'entertainment': 'Развлекательные инструменты и утилиты',
          'education': 'Образовательные инструменты и учебные ресурсы',
          'workplace-slack': 'Инструменты для развлечения и отдыха на рабочем месте',
          'search': 'Поисковые системы и инструменты обнаружения',
          'text': 'Инструменты обработки и редактирования текста',
          'image': 'Инструменты обработки и редактирования изображений',
          'video': 'Инструменты обработки и конвертации видео',
          'audio': 'Инструменты обработки и конвертации аудио',
          'file-transfer': 'Инструменты обмена и передачи файлов'
        },
        'tools': {
          'learn-languages': {
            'name': 'Изучение языков',
            'description': 'ИИ разговорная практика и обучение Q&A с PDF для изучения языков'
          },
          'subtitle-screenshot': {
            'name': 'Генератор скриншотов с субтитрами',
            'description': 'Генератор скриншотов с субтитрами знаменитостей для создания мемов'
          },
          'media-trim': {
            'name': 'Конвертер видео и аудио',
            'description': 'Онлайн конвертер видео в аудио с обрезкой аудио и преобразованием форматов'
          },
          'mbti-test': {
            'name': 'Тест личности MBTI',
            'description': 'Профессиональный тест MBTI с 68 вопросами для глубокого анализа типа личности'
          },
          'video2gif': {
            'name': 'Конвертер Video2GIF',
            'description': 'Онлайн конвертер видео в GIF с поддержкой множества форматов для создания высококачественных анимаций'
          },
          'pic-press': {
            'name': 'Компрессор изображений PicPress',
            'description': 'Бесплатный онлайн компрессор изображений с поддержкой JPG, PNG, WebP, AVIF и локальной обработкой для защиты конфиденциальности'
          },
          'pansou': {
            'name': 'Поиск в облаке PanSou',
            'description': 'Высокопроизводительный API-сервис поиска ресурсов облачного хранилища с поддержкой TG-каналов и плагинов, параллельный многоканальный поиск'
          },
          'text-grove': {
            'name': 'Текстовые инструменты TextGrove',
            'description': 'Комплексный набор инструментов для обработки текста с подсчетом слов, удалением дубликатов, анализом частоты, конвертацией китайского и форматированием'
          },
          'p2p-transfer': {
            'name': 'P2P передача точка-точка',
            'description': 'Безопасный инструмент передачи файлов и текста точка-точка, данные не проходят через серверы, защита конфиденциальности и безопасности'
          },
          'work-whale': {
            'name': 'Work Whale Читалка',
            'description': 'Веб-читалка романов, замаскированная под интерфейс Microsoft Word, идеально вписывается в рабочую среду'
          },
          'stealth-novel': {
            'name': 'StealthNovel Скрытая Читалка',
            'description': 'Скрытая читалка романов для Windows с отображением в заголовке панели задач и режимом маскированных всплывающих окон, незаменима для чтения в офисе'
          }
        }
      }
    };
    
    // 根据IP自动检测语言
    async function detectLocaleByIP() {
      try {
        // 首先检查localStorage是否有用户手动设置的语言
        const savedLocale = localStorage.getItem('locale');
        if (savedLocale) {
          return savedLocale;
        }
        
        // 使用免费的IP地理位置API检测用户位置
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        // 根据国家代码映射到语言
        const countryToLocale = {
          'CN': 'zh-CN',     // 中国大陆
          'TW': 'zh-TW',     // 台湾
          'HK': 'zh-TW',     // 香港
          'MO': 'zh-TW',     // 澳门
          'JP': 'ja-JP',     // 日本
          'RU': 'ru',        // 俄罗斯
          'BY': 'ru',        // 白俄罗斯
          'KZ': 'ru',        // 哈萨克斯坦
          'KG': 'ru',        // 吉尔吉斯斯坦
          'SA': 'ar',        // 沙特阿拉伯
          'AE': 'ar',        // 阿联酋
          'EG': 'ar',        // 埃及
          'JO': 'ar',        // 约旦
          'LB': 'ar',        // 黎巴嫩
          'SY': 'ar',        // 叙利亚
          'IQ': 'ar',        // 伊拉克
          'KW': 'ar',        // 科威特
          'QA': 'ar',        // 卡塔尔
          'BH': 'ar',        // 巴林
          'OM': 'ar',        // 阿曼
          'YE': 'ar',        // 也门
          'MA': 'ar',        // 摩洛哥
          'TN': 'ar',        // 突尼斯
          'DZ': 'ar',        // 阿尔及利亚
          'LY': 'ar',        // 利比亚
          'SD': 'ar',        // 苏丹
        };
        
        return countryToLocale[data.country_code] || 'en'; // 默认英语
      } catch (error) {
        console.log('IP detection failed, using default locale:', error);
        return 'en'; // 检测失败时默认英语
      }
    }
    
    // 获取当前语言
    let currentLocale = 'en'; // 临时设置为英语，等待检测结果
    
    // 异步检测并设置语言
    detectLocaleByIP().then(detectedLocale => {
      currentLocale = detectedLocale;
      languageFlag.textContent = localeData[currentLocale]?.flag || '🇺🇸';
      
      // 初始化页面文本
      updatePageText(currentLocale);
      
      // 初始化当前分类的翻译
      const t = translations[currentLocale] || translations['en'];
      const firstCategory = window.categoriesData[0];
      if (firstCategory) {
        const categoryTitle = document.getElementById('category-title');
        const categoryDescription = document.getElementById('category-description');
        if (categoryTitle) {
          const translatedName = t.categories[firstCategory.id] || firstCategory.name;
          categoryTitle.innerHTML = `<span class="mr-3 text-3xl">${firstCategory.icon}</span>${translatedName}`;
        }
        if (categoryDescription) {
          const translatedDesc = t.category_descriptions[firstCategory.id] || firstCategory.description;
          categoryDescription.textContent = translatedDesc;
        }
      }
      
      console.log('Auto-detected locale:', currentLocale);
    });
    
    // 设置初始语言标志为英语
    languageFlag.textContent = localeData['en']?.flag || '🇺🇸';
    
    // 初始显示英文（在IP检测完成前）
    updatePageText('en');
    const initialT = translations['en'];
    const firstCategory = window.categoriesData[0];
    if (firstCategory) {
      const categoryTitle = document.getElementById('category-title');
      const categoryDescription = document.getElementById('category-description');
      if (categoryTitle) {
        const translatedName = initialT.categories[firstCategory.id] || firstCategory.name;
        categoryTitle.innerHTML = `<span class="mr-3 text-3xl">${firstCategory.icon}</span>${translatedName}`;
      }
      if (categoryDescription) {
        const translatedDesc = initialT.category_descriptions[firstCategory.id] || firstCategory.description;
        categoryDescription.textContent = translatedDesc;
      }
    }
    
    // 更新当前显示的工具卡片
    function updateCurrentToolCards(locale) {
      const t = translations[locale] || translations['en'];
      const toolsGrid = document.getElementById('tools-grid');
      const currentCategoryBtn = document.querySelector('.category-btn.bg-sakura-50, .category-btn[class*="bg-sakura"]');
      
      if (currentCategoryBtn && toolsGrid) {
        const categoryId = currentCategoryBtn.dataset.category;
        const categoryTools = window.toolsData.filter(tool => tool.category === categoryId);
        
        if (categoryTools.length > 0) {
          toolsGrid.innerHTML = categoryTools.map(tool => {
            // 获取翻译的工具名称和描述
            const toolTranslation = t.tools && t.tools[tool.id];
            const translatedName = toolTranslation ? toolTranslation.name : tool.name;
            const translatedDesc = toolTranslation ? toolTranslation.description : tool.description;
            
            return `
            <div class="group cursor-pointer tool-card" data-tool-url="${tool.url}" data-tool-subdomain="${tool.subdomain}">
              <div class="relative overflow-hidden rounded-xl p-6 h-50 bg-gradient-to-br from-sakura-400 to-sakura-600 hover:from-sakura-500 hover:to-sakura-700 transform hover:scale-105 transition-all duration-300 ease-out shadow-lg hover:shadow-xl text-white" style="background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);">
                <div class="absolute top-0 right-0 opacity-20">
                  <div class="w-32 h-32 rounded-full bg-white transform translate-x-8 -translate-y-8"></div>
                </div>
                <div class="absolute bottom-0 left-0 opacity-10">
                  <div class="w-24 h-24 rounded-full bg-white transform -translate-x-4 translate-y-4"></div>
                </div>
                <div class="relative z-10 h-full flex flex-col">
                  <div class="flex items-center justify-between mb-4">
                    <div class="text-3xl">${tool.icon || '🛠️'}</div>
                    ${tool.thirdParty ? `<span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full third-party-badge">🔗 <span class="third-party-text">${t.third_party_text}</span></span>` : tool.featured ? `<span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full featured-badge">⭐ <span class="featured-text">${t.featured_text}</span></span>` : ''}
                  </div>
                  <h3 class="text-xl font-bold mb-2 line-clamp-1">${translatedName}</h3>
                  <p class="text-white/90 text-sm line-clamp-2 mb-4 flex-1">${translatedDesc}</p>
                  <div class="flex items-center justify-between">
                    <div class="flex flex-wrap gap-1">
                      ${tool.tags.slice(0, 2).map(tag => `
                        <span class="bg-white/20 backdrop-blur-sm text-xs px-2 py-1 rounded-full">${tag}</span>
                      `).join('')}
                    </div>
                    <div class="flex items-center text-white/80">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            `;
          }).join('');
        }
      }
    }

    // 更新页面文本的函数
    function updatePageText(locale) {
      const t = translations[locale] || translations['en'];
      
      // 更新站点标题和副标题
      const siteSubtitle = document.querySelector('p.text-sm.text-gray-600');
      if (siteSubtitle) {
        siteSubtitle.textContent = t.site_subtitle;
      }
      
      // 更新分类标题
      const categoriesTitle = document.querySelector('h2.text-sm.font-semibold');
      if (categoriesTitle) {
        categoriesTitle.textContent = t.categories_title;
      }
      
      // 更新分类按钮文本
      const categoryButtons = document.querySelectorAll('.category-btn');
      categoryButtons.forEach(btn => {
        const categoryId = btn.dataset.category;
        const nameSpan = btn.querySelector('span.font-medium');
        if (nameSpan && t.categories[categoryId]) {
          nameSpan.textContent = t.categories[categoryId];
        }
      });
      
      // 更新工具计数文本
      const toolsCountUnit = document.getElementById('tools-count-unit');
      if (toolsCountUnit) {
        toolsCountUnit.textContent = t.tools_count;
      }
      
      // 更新推荐标签文本
      const featuredTexts = document.querySelectorAll('.featured-text');
      featuredTexts.forEach(el => {
        el.textContent = t.featured_text;
      });
      
      // 更新第三方标签文本
      const thirdPartyTexts = document.querySelectorAll('.third-party-text');
      thirdPartyTexts.forEach(el => {
        el.textContent = t.third_party_text;
      });
      
      // 更新按钮title
      const themeToggleBtn = document.getElementById('theme-toggle-btn');
      const languageToggleBtn = document.getElementById('language-toggle-btn');
      if (themeToggleBtn) themeToggleBtn.title = t.theme_toggle_title;
      if (languageToggleBtn) languageToggleBtn.title = t.language_toggle_title;
      
      // 更新空状态文本
      const emptyStateTitle = document.querySelector('#empty-state h3');
      const emptyStateDesc = document.querySelector('#empty-state p');
      if (emptyStateTitle) emptyStateTitle.textContent = t.empty_state_title;
      if (emptyStateDesc) emptyStateDesc.textContent = t.empty_state_desc;
      
      // 更新当前分类描述
      const categoryDesc = document.getElementById('category-description');
      if (categoryDesc) {
        const currentCategoryBtn = document.querySelector('.category-btn.bg-sakura-50, .category-btn[class*="bg-sakura"]');
        if (currentCategoryBtn) {
          const categoryId = currentCategoryBtn.dataset.category;
          if (t.category_descriptions[categoryId]) {
            categoryDesc.textContent = t.category_descriptions[categoryId];
          }
        }
      }
      
      // 更新当前显示的工具卡片
      updateCurrentToolCards(locale);
    }
    
    // 语言切换按钮点击
    languageToggleBtn.addEventListener('click', () => {
      languageDropdown.classList.toggle('hidden');
    });
    
    // 语言选项点击
    languageOptions.forEach(option => {
      option.addEventListener('click', () => {
        const locale = option.dataset.locale;
        localStorage.setItem('locale', locale);
        currentLocale = locale;
        
        // 更新显示
        languageFlag.textContent = localeData[locale]?.flag || '🇺🇸';
        languageDropdown.classList.add('hidden');
        
        // 防止阿拉伯语改变布局 - 暂时禁用RTL
        document.documentElement.lang = locale;
        // document.documentElement.dir = locale === 'ar' ? 'rtl' : 'ltr';
        document.documentElement.dir = 'ltr'; // 强制保持LTR布局
        
        // 更新页面文本
        updatePageText(locale);
        
        console.log('Language changed to:', locale);
      });
    });
    
    // 点击外部关闭下拉菜单
    document.addEventListener('click', (e) => {
      if (!languageToggleBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
        languageDropdown.classList.add('hidden');
      }
    });

    // 分类切换 (注意：categoryButtons 已在上面定义)
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const categoryId = btn.dataset.category;
        const category = window.categoriesData.find(cat => cat.id === categoryId);
        const categoryTools = window.toolsData.filter(tool => tool.category === categoryId);

        // 更新活动状态
        categoryButtons.forEach(b => {
          b.className = b.className.replace(/bg-sakura-\w+|text-sakura-\w+|border-sakura-\w+/g, '');
          b.className = b.className.replace('bg-sakura-50 dark:bg-sakura-900/20 text-sakura-600 dark:text-sakura-400 border border-sakura-200 dark:border-sakura-800', '');
          b.className += ' text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700';
        });
        
        btn.className = btn.className.replace('text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700', '');
        btn.className += ' bg-sakura-50 dark:bg-sakura-900/20 text-sakura-600 dark:text-sakura-400 border border-sakura-200 dark:border-sakura-800';

        // 更新标题（使用翻译）
        const t = translations[currentLocale] || translations['en'];
        const translatedName = t.categories[categoryId] || category.name;
        const translatedDesc = t.category_descriptions[categoryId] || category.description;
        
        categoryTitle.innerHTML = `<span class="mr-3 text-3xl">${category.icon}</span>${translatedName}`;
        categoryDescription.textContent = translatedDesc;
        
        // 更新工具计数文本
        toolsCount.textContent = categoryTools.length;
        const toolsCountUnit = document.getElementById('tools-count-unit');
        if (toolsCountUnit) {
          toolsCountUnit.textContent = t.tools_count;
        }

        // 更新工具网格
        if (categoryTools.length === 0) {
          toolsGrid.classList.add('hidden');
          emptyState.classList.remove('hidden');
        } else {
          toolsGrid.classList.remove('hidden');
          emptyState.classList.add('hidden');
          
          toolsGrid.innerHTML = categoryTools.map(tool => {
            // 获取翻译的工具名称和描述
            const toolTranslation = t.tools && t.tools[tool.id];
            const translatedName = toolTranslation ? toolTranslation.name : tool.name;
            const translatedDesc = toolTranslation ? toolTranslation.description : tool.description;
            
            return `
            <div class="group cursor-pointer tool-card" data-tool-url="${tool.url}" data-tool-subdomain="${tool.subdomain}">
              <div class="relative overflow-hidden rounded-xl p-6 h-50 bg-gradient-to-br from-sakura-400 to-sakura-600 hover:from-sakura-500 hover:to-sakura-700 transform hover:scale-105 transition-all duration-300 ease-out shadow-lg hover:shadow-xl text-white" style="background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);">
                <div class="absolute top-0 right-0 opacity-20">
                  <div class="w-32 h-32 rounded-full bg-white transform translate-x-8 -translate-y-8"></div>
                </div>
                <div class="absolute bottom-0 left-0 opacity-10">
                  <div class="w-24 h-24 rounded-full bg-white transform -translate-x-4 translate-y-4"></div>
                </div>
                <div class="relative z-10 h-full flex flex-col">
                  <div class="flex items-center justify-between mb-4">
                    <div class="text-3xl">${tool.icon || '🛠️'}</div>
                    ${tool.thirdParty ? `<span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full third-party-badge">🔗 <span class="third-party-text">${t.third_party_text}</span></span>` : tool.featured ? `<span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full featured-badge">⭐ <span class="featured-text">${t.featured_text}</span></span>` : ''}
                  </div>
                  <h3 class="text-xl font-bold mb-2 line-clamp-1">${translatedName}</h3>
                  <p class="text-white/90 text-sm line-clamp-2 mb-4 flex-1">${translatedDesc}</p>
                  <div class="flex items-center justify-between">
                    <div class="flex flex-wrap gap-1">
                      ${tool.tags.slice(0, 2).map(tag => `
                        <span class="bg-white/20 backdrop-blur-sm text-xs px-2 py-1 rounded-full">${tag}</span>
                      `).join('')}
                    </div>
                    <div class="flex items-center text-white/80">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            `;
          }).join('');
        }
      });
    });

    // 工具卡片点击事件
    document.addEventListener('click', (e) => {
      const toolCard = e.target.closest('.tool-card');
      if (toolCard) {
        const url = toolCard.dataset.toolUrl;
        if (url) {
          window.open(url, '_blank', 'noopener,noreferrer');
        }
      }
    });
  });
</script>

<style>
  /* 自定义滚动条 */
  aside {
    scrollbar-width: thin;
    scrollbar-color: #e5e7eb transparent;
  }
  
  aside::-webkit-scrollbar {
    width: 6px;
  }
  
  aside::-webkit-scrollbar-track {
    background: transparent;
  }
  
  aside::-webkit-scrollbar-thumb {
    background: #e5e7eb;
    border-radius: 3px;
  }
  
  aside::-webkit-scrollbar-thumb:hover {
    background: #d1d5db;
  }

  /* 文本截断 */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>