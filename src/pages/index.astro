---
import Base from '../layouts/Base.astro';
import { tools, categories, getToolsCountByCategory } from '../data/tools';

// é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªåˆ†ç±»çš„å·¥å…·
const defaultCategory = categories[0];
const defaultTools = tools.filter(tool => tool.category === defaultCategory.id);
---

<Base 
  title="OumaShu - å°å·¥å…·å¯¼èˆªç«™"
  description="æç®€æ—¥å¼é£æ ¼çš„å°å·¥å…·é›†åˆç«™ã€‚åˆ†ç±»æµè§ˆï¼Œæå‡æ‚¨çš„å·¥ä½œæ•ˆç‡ã€‚"
  keywords="å·¥å…·, æ•ˆç‡, å¯¼èˆª, åº”ç”¨, ç”Ÿäº§åŠ›, åˆ†ç±»"
>
  <div class="min-h-screen flex">
    <!-- å·¦ä¾§è¾¹æ  -->
    <aside class="w-64 bg-white dark:bg-black border-r border-gray-200 dark:border-gray-700 fixed h-full overflow-y-auto flex flex-col">
      <!-- Logo -->
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center space-x-2">
          <span class="text-2xl">ğŸŒ¸</span>
          <h1 class="text-xl font-bold text-gray-900 dark:text-white">OumaShu</h1>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">å°å·¥å…·å¯¼èˆªç«™</p>
      </div>

      <!-- åˆ†ç±»åˆ—è¡¨ -->
      <nav class="p-4">
        <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">
          å·¥å…·åˆ†ç±»
        </h2>
        <ul class="space-y-1" id="category-list">
          {categories.map((category, index) => {
            const toolCount = getToolsCountByCategory(tools, category.id);
            return (
              <li>
                <button
                  data-category={category.id}
                  class={`
                    w-full flex items-center justify-between px-3 py-2 rounded-lg text-left transition-all duration-200
                    ${index === 0 
                      ? 'bg-sakura-50 dark:bg-sakura-900/20 text-sakura-600 dark:text-sakura-400 border border-sakura-200 dark:border-sakura-800' 
                      : 'text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700'
                    }
                    category-btn
                  `}
                >
                  <div class="flex items-center space-x-3">
                    <span class="text-lg">{category.icon}</span>
                    <span class="font-medium">{category.name}</span>
                  </div>
                  <span class="text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full">
                    {toolCount}
                  </span>
                </button>
              </li>
            );
          })}
        </ul>
      </nav>

      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="p-4 mt-auto border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-black">
        <div class="flex items-center justify-between">
          <!-- ä¸»é¢˜åˆ‡æ¢ -->
          <div class="relative">
            <button 
              id="theme-toggle-btn"
              class="p-2 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              title="åˆ‡æ¢ä¸»é¢˜"
            >
              <span id="theme-icon" class="text-lg">ğŸ’»</span>
            </button>
          </div>
          
          <!-- è¯­è¨€åˆ‡æ¢ -->
          <div class="relative">
            <button 
              id="language-toggle-btn"
              class="flex items-center space-x-1 px-2 py-1 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              title="åˆ‡æ¢è¯­è¨€"
            >
              <span id="language-flag">ğŸ‡¨ğŸ‡³</span>
              <span class="text-xs">â–¼</span>
            </button>
            
            <!-- è¯­è¨€ä¸‹æ‹‰èœå• -->
            <div 
              id="language-dropdown" 
              class="hidden absolute bottom-full mb-2 right-0 w-44 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl z-50"
            >
              <div class="py-1">
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="zh-CN">
                  <span>ğŸ‡¨ğŸ‡³</span>
                  <span>ç®€ä½“ä¸­æ–‡</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="zh-TW">
                  <span>ğŸ‡¹ğŸ‡¼</span>
                  <span>ç¹é«”ä¸­æ–‡</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="en">
                  <span>ğŸ‡ºğŸ‡¸</span>
                  <span>English</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="ja-JP">
                  <span>ğŸ‡¯ğŸ‡µ</span>
                  <span>æ—¥æœ¬èª</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="ar">
                  <span>ğŸ‡¸ğŸ‡¦</span>
                  <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                </button>
                <button class="language-option w-full flex items-center space-x-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-locale="ru">
                  <span>ğŸ‡·ğŸ‡º</span>
                  <span>Ğ ÑƒÑÑĞºĞ¸Ğ¹</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="flex-1 ml-64 bg-gray-50 dark:bg-black min-h-screen">
      <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
      <header class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-8 py-6">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center" id="category-title">
              <span class="mr-3 text-3xl">{defaultCategory.icon}</span>
              {defaultCategory.name}
            </h2>
            <p class="text-gray-600 dark:text-gray-400 mt-1" id="category-description">
              {defaultCategory.description}
            </p>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            <span id="tools-count">{defaultTools.length}</span> ä¸ªå·¥å…·
          </div>
        </div>
      </header>

      <!-- å·¥å…·å¡ç‰‡ç½‘æ ¼ -->
      <div class="p-8 bg-gray-50 dark:bg-black">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="tools-grid">
          {defaultTools.map((tool) => (
            <div 
              class="group cursor-pointer tool-card"
              data-tool-url={tool.url}
              data-tool-subdomain={tool.subdomain}
            >
              <div class="
                relative overflow-hidden rounded-xl p-6 h-50
                bg-gradient-to-br from-sakura-400 to-sakura-600
                hover:from-sakura-500 hover:to-sakura-700
                transform hover:scale-105 transition-all duration-300 ease-out
                shadow-lg hover:shadow-xl
                text-white
              ">
                {/* èƒŒæ™¯è£…é¥° */}
                <div class="absolute top-0 right-0 opacity-20">
                  <div class="w-32 h-32 rounded-full bg-white transform translate-x-8 -translate-y-8"></div>
                </div>
                <div class="absolute bottom-0 left-0 opacity-10">
                  <div class="w-24 h-24 rounded-full bg-white transform -translate-x-4 translate-y-4"></div>
                </div>

                {/* å†…å®¹ */}
                <div class="relative z-10 h-full flex flex-col">
                  <div class="flex items-center justify-between mb-4">
                    <div class="text-3xl">{tool.icon || 'ğŸ› ï¸'}</div>
                    {tool.featured && (
                      <span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full">
                        â­ æ¨è
                      </span>
                    )}
                  </div>
                  
                  <h3 class="text-xl font-bold mb-2 line-clamp-1">
                    {tool.name}
                  </h3>
                  
                  <p class="text-white/90 text-sm line-clamp-2 mb-4 flex-1">
                    {tool.description}
                  </p>
                  
                  <div class="flex items-center justify-between">
                    <div class="flex flex-wrap gap-1">
                      {tool.tags.slice(0, 2).map((tag) => (
                        <span class="bg-white/20 backdrop-blur-sm text-xs px-2 py-1 rounded-full">
                          {tag}
                        </span>
                      ))}
                    </div>
                    
                    <div class="flex items-center text-white/80">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* ç©ºçŠ¶æ€ */}
        <div id="empty-state" class="hidden text-center py-16">
          <div class="text-6xl mb-4">ğŸ“¦</div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">
            è¯¥åˆ†ç±»æš‚æ— å·¥å…·
          </h3>
          <p class="text-gray-600 dark:text-gray-400">
            æ›´å¤šå·¥å…·æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼
          </p>
        </div>
      </div>
    </main>
  </div>
</Base>

<!-- å·¥å…·æ•°æ® -->
<script define:vars={{ tools, categories }}>
  // å·¥å…·æ•°æ®
  window.toolsData = tools;
  window.categoriesData = categories;
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const themeIcon = document.getElementById('theme-icon');
    
    // è·å–å½“å‰ä¸»é¢˜
    function getCurrentTheme() {
      return localStorage.getItem('theme') || 'system';
    }
    
    // è·å–å®é™…ä¸»é¢˜ï¼ˆå¤„ç† system æ¨¡å¼ï¼‰
    function getActualTheme(theme) {
      if (theme === 'system') {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      return theme;
    }
    
    // åº”ç”¨ä¸»é¢˜
    function applyTheme(theme) {
      const actualTheme = getActualTheme(theme);
      document.documentElement.setAttribute('data-theme', actualTheme);
      
      // æ›´æ–°å›¾æ ‡
      const icons = { light: 'â˜€ï¸', dark: 'ğŸŒ™', system: 'ğŸ’»' };
      themeIcon.textContent = icons[theme] || 'ğŸ’»';
      
      // æ›´æ–° meta theme-color
      const metaThemeColor = document.querySelector('meta[name="theme-color"]');
      if (metaThemeColor) {
        metaThemeColor.setAttribute('content', actualTheme === 'dark' ? '#000000' : '#fff5f7');
      }
    }
    
    // åˆå§‹åŒ–ä¸»é¢˜
    let currentTheme = getCurrentTheme();
    applyTheme(currentTheme);
    
    // ä¸»é¢˜åˆ‡æ¢ç‚¹å‡»äº‹ä»¶
    themeToggleBtn.addEventListener('click', () => {
      const themes = ['light', 'dark', 'system'];
      const currentIndex = themes.indexOf(currentTheme);
      const nextIndex = (currentIndex + 1) % themes.length;
      currentTheme = themes[nextIndex];
      
      localStorage.setItem('theme', currentTheme);
      applyTheme(currentTheme);
    });
    
    // è¯­è¨€åˆ‡æ¢åŠŸèƒ½
    const languageToggleBtn = document.getElementById('language-toggle-btn');
    const languageDropdown = document.getElementById('language-dropdown');
    const languageFlag = document.getElementById('language-flag');
    const languageOptions = document.querySelectorAll('.language-option');
    
    const localeData = {
      'zh-CN': { flag: 'ğŸ‡¨ğŸ‡³', name: 'ç®€ä½“ä¸­æ–‡' },
      'zh-TW': { flag: 'ğŸ‡¹ğŸ‡¼', name: 'ç¹é«”ä¸­æ–‡' },
      'en': { flag: 'ğŸ‡ºğŸ‡¸', name: 'English' },
      'ja-JP': { flag: 'ğŸ‡¯ğŸ‡µ', name: 'æ—¥æœ¬èª' },
      'ar': { flag: 'ğŸ‡¸ğŸ‡¦', name: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' },
      'ru': { flag: 'ğŸ‡·ğŸ‡º', name: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹' }
    };

    // ç¿»è¯‘æ˜ å°„
    const translations = {
      'zh-CN': {
        'site_name': 'OumaShu',
        'site_subtitle': 'å°å·¥å…·å¯¼èˆªç«™',
        'categories_title': 'å·¥å…·åˆ†ç±»',
        'tools_count': 'ä¸ªå·¥å…·',
        'empty_state_title': 'è¯¥åˆ†ç±»æš‚æ— å·¥å…·',
        'empty_state_desc': 'æ›´å¤šå·¥å…·æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼',
        'categories': {
          'entertainment': 'å¨±ä¹',
          'education': 'æ•™è‚²'
        },
        'category_descriptions': {
          'entertainment': 'å¨±ä¹å·¥å…·å’Œæœ‰è¶£åº”ç”¨',
          'education': 'æ•™è‚²å·¥å…·å’Œå­¦ä¹ èµ„æº'
        }
      },
      'zh-TW': {
        'site_name': 'OumaShu',
        'site_subtitle': 'å°å·¥å…·å°èˆªç«™',
        'categories_title': 'å·¥å…·åˆ†é¡',
        'tools_count': 'å€‹å·¥å…·',
        'empty_state_title': 'è©²åˆ†é¡æš«ç„¡å·¥å…·',
        'empty_state_desc': 'æ›´å¤šå·¥å…·æ­£åœ¨é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼',
        'categories': {
          'entertainment': 'å¨›æ¨‚',
          'education': 'æ•™è‚²'
        },
        'category_descriptions': {
          'entertainment': 'å¨›æ¨‚å·¥å…·å’Œæœ‰è¶£æ‡‰ç”¨',
          'education': 'æ•™è‚²å·¥å…·å’Œå­¸ç¿’è³‡æº'
        }
      },
      'en': {
        'site_name': 'OumaShu',
        'site_subtitle': 'Tools Directory',
        'categories_title': 'Tool Categories',
        'tools_count': 'tools',
        'empty_state_title': 'No tools in this category',
        'empty_state_desc': 'More tools are coming soon!',
        'categories': {
          'entertainment': 'Entertainment',
          'education': 'Education'
        },
        'category_descriptions': {
          'entertainment': 'Fun tools and entertainment utilities',
          'education': 'Educational tools and learning resources'
        }
      },
      'ja-JP': {
        'site_name': 'OumaShu',
        'site_subtitle': 'ãƒ„ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª',
        'categories_title': 'ãƒ„ãƒ¼ãƒ«ã‚«ãƒ†ã‚´ãƒª',
        'tools_count': 'ãƒ„ãƒ¼ãƒ«',
        'empty_state_title': 'ã“ã®ã‚«ãƒ†ã‚´ãƒªã«ã¯ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“',
        'empty_state_desc': 'ã‚ˆã‚Šå¤šãã®ãƒ„ãƒ¼ãƒ«ãŒè¿‘æ—¥å…¬é–‹äºˆå®šã§ã™ï¼',
        'categories': {
          'entertainment': 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ',
          'education': 'æ•™è‚²'
        },
        'category_descriptions': {
          'entertainment': 'æ¥½ã—ã„ãƒ„ãƒ¼ãƒ«ã¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£',
          'education': 'æ•™è‚²ãƒ„ãƒ¼ãƒ«ã¨å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹'
        }
      },
      'ar': {
        'site_name': 'OumaShu',
        'site_subtitle': 'Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª',
        'categories_title': 'ÙØ¦Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Øª',
        'tools_count': 'Ø£Ø¯ÙˆØ§Øª',
        'empty_state_title': 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆØ§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©',
        'empty_state_desc': 'Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ù‚Ø§Ø¯Ù…Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹!',
        'categories': {
          'entertainment': 'Ø§Ù„ØªØ±ÙÙŠÙ‡',
          'education': 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…'
        },
        'category_descriptions': {
          'entertainment': 'Ø£Ø¯ÙˆØ§Øª Ù…Ù…ØªØ¹Ø© ÙˆÙ…Ø±Ø§ÙÙ‚ ØªØ±ÙÙŠÙ‡ÙŠØ©',
          'education': 'Ø£Ø¯ÙˆØ§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆÙ…ÙˆØ§Ø±Ø¯ ØªØ¹Ù„Ù…'
        }
      },
      'ru': {
        'site_name': 'OumaShu',
        'site_subtitle': 'ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²',
        'categories_title': 'ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²',
        'tools_count': 'Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²',
        'empty_state_title': 'Ğ’ ÑÑ‚Ğ¾Ğ¹ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ Ğ½ĞµÑ‚ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²',
        'empty_state_desc': 'Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ Ğ² Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ!',
        'categories': {
          'entertainment': 'Ğ Ğ°Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ñ',
          'education': 'ĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ'
        },
        'category_descriptions': {
          'entertainment': 'Ğ Ğ°Ğ·Ğ²Ğ»ĞµĞºĞ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹',
          'education': 'ĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¸ ÑƒÑ‡ĞµĞ±Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹'
        }
      }
    };
    
    // è·å–å½“å‰è¯­è¨€
    let currentLocale = localStorage.getItem('locale') || 'zh-CN';
    languageFlag.textContent = localeData[currentLocale]?.flag || 'ğŸ‡¨ğŸ‡³';
    
    // æ›´æ–°é¡µé¢æ–‡æœ¬çš„å‡½æ•°
    function updatePageText(locale) {
      const t = translations[locale] || translations['zh-CN'];
      
      // æ›´æ–°ç«™ç‚¹æ ‡é¢˜å’Œå‰¯æ ‡é¢˜
      const siteSubtitle = document.querySelector('p.text-sm.text-gray-600');
      if (siteSubtitle) {
        siteSubtitle.textContent = t.site_subtitle;
      }
      
      // æ›´æ–°åˆ†ç±»æ ‡é¢˜
      const categoriesTitle = document.querySelector('h2.text-sm.font-semibold');
      if (categoriesTitle) {
        categoriesTitle.textContent = t.categories_title;
      }
      
      // æ›´æ–°åˆ†ç±»æŒ‰é’®æ–‡æœ¬
      const categoryButtons = document.querySelectorAll('.category-btn');
      categoryButtons.forEach(btn => {
        const categoryId = btn.dataset.category;
        const nameSpan = btn.querySelector('span.font-medium');
        if (nameSpan && t.categories[categoryId]) {
          nameSpan.textContent = t.categories[categoryId];
        }
      });
      
      // æ›´æ–°å·¥å…·è®¡æ•°æ–‡æœ¬
      const toolsCountText = document.getElementById('tools-count');
      if (toolsCountText) {
        const count = toolsCountText.textContent;
        const parentElement = toolsCountText.parentElement;
        if (parentElement) {
          parentElement.innerHTML = `<span id="tools-count">${count}</span> ${t.tools_count}`;
        }
      }
      
      // æ›´æ–°ç©ºçŠ¶æ€æ–‡æœ¬
      const emptyStateTitle = document.querySelector('#empty-state h3');
      const emptyStateDesc = document.querySelector('#empty-state p');
      if (emptyStateTitle) emptyStateTitle.textContent = t.empty_state_title;
      if (emptyStateDesc) emptyStateDesc.textContent = t.empty_state_desc;
      
      // æ›´æ–°å½“å‰åˆ†ç±»æè¿°
      const categoryDesc = document.getElementById('category-description');
      if (categoryDesc) {
        const currentCategoryBtn = document.querySelector('.category-btn.bg-sakura-50, .category-btn[class*="bg-sakura"]');
        if (currentCategoryBtn) {
          const categoryId = currentCategoryBtn.dataset.category;
          if (t.category_descriptions[categoryId]) {
            categoryDesc.textContent = t.category_descriptions[categoryId];
          }
        }
      }
    }
    
    // åˆå§‹åŒ–é¡µé¢æ–‡æœ¬
    updatePageText(currentLocale);
    
    // è¯­è¨€åˆ‡æ¢æŒ‰é’®ç‚¹å‡»
    languageToggleBtn.addEventListener('click', () => {
      languageDropdown.classList.toggle('hidden');
    });
    
    // è¯­è¨€é€‰é¡¹ç‚¹å‡»
    languageOptions.forEach(option => {
      option.addEventListener('click', () => {
        const locale = option.dataset.locale;
        localStorage.setItem('locale', locale);
        currentLocale = locale;
        
        // æ›´æ–°æ˜¾ç¤º
        languageFlag.textContent = localeData[locale]?.flag || 'ğŸ‡¨ğŸ‡³';
        languageDropdown.classList.add('hidden');
        
        // é˜²æ­¢é˜¿æ‹‰ä¼¯è¯­æ”¹å˜å¸ƒå±€ - æš‚æ—¶ç¦ç”¨RTL
        document.documentElement.lang = locale;
        // document.documentElement.dir = locale === 'ar' ? 'rtl' : 'ltr';
        document.documentElement.dir = 'ltr'; // å¼ºåˆ¶ä¿æŒLTRå¸ƒå±€
        
        // æ›´æ–°é¡µé¢æ–‡æœ¬
        updatePageText(locale);
        
        console.log('Language changed to:', locale);
      });
    });
    
    // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
    document.addEventListener('click', (e) => {
      if (!languageToggleBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
        languageDropdown.classList.add('hidden');
      }
    });
    const categoryButtons = document.querySelectorAll('.category-btn');
    const toolsGrid = document.getElementById('tools-grid');
    const categoryTitle = document.getElementById('category-title');
    const categoryDescription = document.getElementById('category-description');
    const toolsCount = document.getElementById('tools-count');
    const emptyState = document.getElementById('empty-state');

    // åˆ†ç±»åˆ‡æ¢
    categoryButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const categoryId = btn.dataset.category;
        const category = window.categoriesData.find(cat => cat.id === categoryId);
        const categoryTools = window.toolsData.filter(tool => tool.category === categoryId);

        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
        categoryButtons.forEach(b => {
          b.className = b.className.replace(/bg-sakura-\w+|text-sakura-\w+|border-sakura-\w+/g, '');
          b.className = b.className.replace('bg-sakura-50 dark:bg-sakura-900/20 text-sakura-600 dark:text-sakura-400 border border-sakura-200 dark:border-sakura-800', '');
          b.className += ' text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700';
        });
        
        btn.className = btn.className.replace('text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700', '');
        btn.className += ' bg-sakura-50 dark:bg-sakura-900/20 text-sakura-600 dark:text-sakura-400 border border-sakura-200 dark:border-sakura-800';

        // æ›´æ–°æ ‡é¢˜ï¼ˆä½¿ç”¨ç¿»è¯‘ï¼‰
        const t = translations[currentLocale] || translations['zh-CN'];
        const translatedName = t.categories[categoryId] || category.name;
        const translatedDesc = t.category_descriptions[categoryId] || category.description;
        
        categoryTitle.innerHTML = `<span class="mr-3 text-3xl">${category.icon}</span>${translatedName}`;
        categoryDescription.textContent = translatedDesc;
        
        // æ›´æ–°å·¥å…·è®¡æ•°æ–‡æœ¬
        const countParent = toolsCount.parentElement;
        if (countParent) {
          countParent.innerHTML = `<span id="tools-count">${categoryTools.length}</span> ${t.tools_count}`;
        }

        // æ›´æ–°å·¥å…·ç½‘æ ¼
        if (categoryTools.length === 0) {
          toolsGrid.classList.add('hidden');
          emptyState.classList.remove('hidden');
        } else {
          toolsGrid.classList.remove('hidden');
          emptyState.classList.add('hidden');
          
          toolsGrid.innerHTML = categoryTools.map(tool => `
            <div class="group cursor-pointer tool-card" data-tool-url="${tool.url}" data-tool-subdomain="${tool.subdomain}">
              <div class="
                relative overflow-hidden rounded-xl p-6 h-50
                bg-gradient-to-br from-sakura-400 to-sakura-600
                hover:from-sakura-500 hover:to-sakura-700
                transform hover:scale-105 transition-all duration-300 ease-out
                shadow-lg hover:shadow-xl
                text-white
              ">
                <div class="absolute top-0 right-0 opacity-20">
                  <div class="w-32 h-32 rounded-full bg-white transform translate-x-8 -translate-y-8"></div>
                </div>
                <div class="absolute bottom-0 left-0 opacity-10">
                  <div class="w-24 h-24 rounded-full bg-white transform -translate-x-4 translate-y-4"></div>
                </div>
                <div class="relative z-10 h-full flex flex-col">
                  <div class="flex items-center justify-between mb-4">
                    <div class="text-3xl">${tool.icon || 'ğŸ› ï¸'}</div>
                    ${tool.featured ? '<span class="bg-white/20 backdrop-blur-sm text-white text-xs px-2 py-1 rounded-full">â­ æ¨è</span>' : ''}
                  </div>
                  <h3 class="text-xl font-bold mb-2 line-clamp-1">${tool.name}</h3>
                  <p class="text-white/90 text-sm line-clamp-2 mb-4 flex-1">${tool.description}</p>
                  <div class="flex items-center justify-between">
                    <div class="flex flex-wrap gap-1">
                      ${tool.tags.slice(0, 2).map(tag => `
                        <span class="bg-white/20 backdrop-blur-sm text-xs px-2 py-1 rounded-full">${tag}</span>
                      `).join('')}
                    </div>
                    <div class="flex items-center text-white/80">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `).join('');
        }
      });
    });

    // å·¥å…·å¡ç‰‡ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', (e) => {
      const toolCard = e.target.closest('.tool-card');
      if (toolCard) {
        const url = toolCard.dataset.toolUrl;
        if (url) {
          window.open(url, '_blank', 'noopener,noreferrer');
        }
      }
    });
  });
</script>

<style>
  /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
  aside {
    scrollbar-width: thin;
    scrollbar-color: #e5e7eb transparent;
  }
  
  aside::-webkit-scrollbar {
    width: 6px;
  }
  
  aside::-webkit-scrollbar-track {
    background: transparent;
  }
  
  aside::-webkit-scrollbar-thumb {
    background: #e5e7eb;
    border-radius: 3px;
  }
  
  aside::-webkit-scrollbar-thumb:hover {
    background: #d1d5db;
  }

  /* æ–‡æœ¬æˆªæ–­ */
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>